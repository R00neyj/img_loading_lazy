# Image Performance & Layout Optimizer (v1.7.0)

본 프로젝트는 대규모 웹 서비스의 마크업 품질과 성능 지표(Core Web Vitals)를 개선하기 위한 이미지 최적화 자동화 도구입니다. 정밀한 바이너리 분석과 정규식 엔진을 통해 원본 소스의 손상 없이 레이아웃 시프트(CLS) 방지 및 로딩 성능 최적화를 수행합니다.

## 핵심 업데이트 (v1.7.0)
- **단일 실행 파일(.exe) 지원**: Node.js가 설치되지 않은 환경에서도 즉시 실행 가능한 바이너리 배포판을 제공합니다.
- **스마트 워크플로우**: 실행 시 필수 폴더(`input`, `images`)가 없거나 변환할 파일이 없을 경우, 프로그램을 종료하지 않고 사용자에게 안내 후 실시간으로 대기하는 인터랙티브 모드가 추가되었습니다.
- **비동기 디코딩(decoding="async") 적용**: 레이지 로딩과 함께 이미지 디코딩을 비동기로 처리하여 브라우저 메인 스레드의 부하를 줄이고 스크롤 성능을 극대화합니다.
- **XHTML 및 Self-Closing 규격 지원**: 이미지 태그가 슬래시(`/`)로 닫히는 규격에서 속성이 잘못 부착되는 문제를 해결하여 안정적인 마크업을 보장합니다.

## 주요 기능
- **무설치 독립 실행**: 별도의 라이브러리 설치 없이 `loadinglazy.exe` 파일 하나로 모든 기능을 수행합니다.
- **CLS(Cumulative Layout Shift) 방지**: 이미지 바이너리 헤더를 분석하여 `width`, `height` 값을 산출하고 HTML 속성으로 명시합니다.
- **단위 기반 유동적 스타일링**: `rem`(10px 기준) 또는 `vw`(해상도 가로폭 기준) 단위로 이미지 너비를 자동 계산하여 인라인 스타일을 부여합니다.
- **구조 보존형 엔진**: Cheerio와 같은 DOM 파서의 자동 태그 생성 부작용을 제거하고, 정교한 정규식 엔진을 통해 PHP 로직 및 주석의 구조를 100% 보존합니다.

## 실행 가이드

### 1. 실행 파일 사용 (권장)
GitHub Releases에서 `loadinglazy.exe`를 다운로드하여 실행합니다.
- **폴더 자동 생성**: 실행 시 `input`, `images`, `output` 폴더가 자동으로 생성됩니다.
- **대화형 설정**: 터미널 안내에 따라 단위(rem/vw)와 로딩 레이지 적용 여부를 선택합니다.
- **실시간 확인**: `input` 폴더가 비어있을 경우, 파일을 넣고 엔터를 누르면 즉시 변환을 시작합니다.

### 2. 배치파일 및 CLI 사용
Node.js가 설치된 환경에서 `run.bat`을 실행하거나 아래 명령어를 사용합니다.

```bash
# 라이브러리 설치 (최초 1회)
npm install

# CLI 명령어 (단위, 기준폭, 로딩레이지여부)
node convert_loading_lazy.js rem 10 true
```

### 파라미터 상세
- **Unit**: 출력 너비 단위 (`rem` / `vw`)
- **BaseWidth**: `vw` 단위 계산의 기준이 되는 해상도 가로폭
- **UseLazy**: `loading="lazy"` 및 `decoding="async"` 속성 적용 여부 (`true` / `false`)

## 기술 사양 및 주의 사항
- **엔진**: Node.js Native Regex Engine (pkg bundled)
- **지원 포맷**: PNG, JPG/JPEG, WebP
- **경로 분석**: 이미지 소스는 `images/` 폴더 내에 존재해야 하며, HTML 내 경로와 매칭되어야 분석이 가능합니다.
- **보안**: PHP 블록 및 HTML 주석 내의 콘텐츠는 변환 대상에서 제외되도록 설계되었습니다.
