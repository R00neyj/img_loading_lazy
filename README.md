# Image Performance & Layout Optimizer (v1.6.0)

본 프로젝트는 대규모 웹 서비스의 마크업 품질과 성능 지표(Core Web Vitals)를 개선하기 위한 이미지 최적화 자동화 도구입니다. 정밀한 바이너리 분석과 정규식 엔진을 통해 원본 소스의 손상 없이 레이아웃 시프트(CLS) 방지 및 로딩 성능 최적화를 수행합니다.

## 핵심 업데이트 (v1.6.0)
- **비동기 디코딩(decoding="async") 적용**: 레이지 로딩과 함께 이미지 디코딩을 비동기로 처리하여 브라우저 메인 스레드의 부하를 줄이고 스크롤 성능을 극대화합니다.
- **XHTML 및 Self-Closing 규격 지원**: 이미지 태그가 슬래시(`/`)로 닫히는 규격에서 속성이 잘못 부착되는 문제를 해결하여 안정적인 마크업을 보장합니다.
- **구조 보존형 엔진**: Cheerio와 같은 DOM 파서의 자동 태그 생성 부작용을 제거하고, 정교한 정규식 엔진을 통해 PHP 로직 및 주석의 구조를 100% 보존합니다.

## 주요 기능
- **CLS(Cumulative Layout Shift) 방지**: 이미지 바이너리 헤더를 분석하여 `width`, `height` 값을 산출하고 HTML 속성으로 명시합니다.
- **단위 기반 유동적 스타일링**: `rem`(10px 기준) 또는 `vw`(해상도 가로폭 기준) 단위로 이미지 너비를 자동 계산하여 인라인 스타일을 부여합니다.
- **스마트 속성 부여**: 기존에 정의된 속성이 있을 경우 이를 존중하며, 중복 정의를 방지하는 스마트 필터링 로직이 적용되어 있습니다.

## 실행 가이드

### 환경 설정
1. `input/` 디렉토리에 변환할 `.html` 또는 `.php` 파일을 배치합니다.
2. 실행 환경에 로컬 이미지 자원이 존재해야 바이너리 분석을 통한 크기 계산이 가능합니다.

### 실행 명령어
`run.bat`를 통한 대화형 실행 또는 아래의 CLI 명령어를 사용할 수 있습니다.

```bash
# 기본 사용 (rem 단위, 로딩 레이지 사용)
node convert_loading_lazy.js rem 10 true

# vw 단위 사용 (기준폭 1920px, 로딩 레이지 미사용)
node convert_loading_lazy.js vw 1920 false
```

### 파라미터 상세
- **Unit**: 출력 너비 단위 (`rem` / `vw`)
- **BaseWidth**: `vw` 단위 계산의 기준이 되는 해상도 가로폭
- **UseLazy**: `loading="lazy"` 및 `decoding="async"` 속성 적용 여부 (`true` / `false`)

## 기술 사양 및 주의 사항
- **엔진**: Node.js Native Regex Engine
- **지원 포맷**: PNG, JPG/JPEG, WebP
- **경로 분석**: 절대 경로(`/`) 및 상대 경로를 모두 지원하며, 프로젝트 루트를 기준으로 자원을 탐색합니다.
- **보안**: PHP 블록 및 HTML 주석 내의 콘텐츠는 변환 대상에서 제외되도록 설계되었습니다.
